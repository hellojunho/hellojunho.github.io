---
layout: single
title: "📘[Web] 싱글톤 패턴이란?"
toc: true
toc_sticky: true
toc_label: "목차"
categories: web
excerpt: ""
tag: [spring, design pattern]
---

# 싱글톤 패턴이란?
`싱글톤 패턴(Singleton pattern)`이란, 객체의 **인스턴스가 오직 1개**만 생성되는 패턴을 의미한다.  
즉, 클래스의 인스턴스가 딱 1개만 생성되는 것을 보장하는 디자인 패턴이다.  

주의할 점  
: 객체 인스턴스를 2개 이상 생성하지 못하도록 막아야한다!
: `private 생성자`를 사용해서 외부에서 임의로 `new 키워드`를 사용하지 못하게 하자!

[예제]  
```java
public class Singleton {

    private static Singleton instance = new Singleton();
    
    private Singleton() {
        // 생성자는 외부에서 호출못하게 private 으로 지정해야 한다.
    }

    public static Singleton getInstance() {
        return instance;
    }

    public void say() {
        System.out.println("hi, there");
    }
}
```  
위의 예제를 보면, Singleton 클래스의 객체는 `instance`하나 뿐이다.  

## 싱글톤 패턴의 장점
싱글톤 패턴으로 사용하면 인스턴스가 1개만 생성되는데, 왜 싱글톤 패턴을 사용할까?  
<br>

먼저, **메모리의 절약**의 장점이 있다.  
객체는 생성할 때마다 메모리 영역을 할당받아야 한다.  
하지만 한 번의 `new`를 통해 객체를 생성한다면 메모리의 낭비를 방지할 수 있다.  
<br>

다음으로는 **클래스 간의 데이터 공유 용이** 측면이다.  
**싱글톤 인스턴스는 전역으로 사용되는 인스턴스**이기 때문에 다른 클래스의 인스턴스들이 접근(데이터를 공유)하여 사용할 수 있다.  
<br>

하지만 여러 클래스의 인스턴스에서 싱글톤 인스턴스의 데이터에 동시에 접근하게 되면 **동시성 문제**가 발생할 수 있으니 이점을 유의해서 설계하는 것이 좋다.  

### 동시성 문제?
동시성 문제란, **동일한 하나의 데이터에 둘 이상의 스레드, 혹은 세션에서 가변 데이터를 동시에 제어할 때 나타는 문제**를 말한다.  
쉽게 말해 동일한 자원에 대해 여러 스레드가 동시에 접근 하면서 발생하는 문제라고 할 수 있다.  
<br>

해결방법으로는 **쓰레드 로컬(Thread Local)** 이 있다.  

## 싱글톤 페턴의 문제점
싱글톤 패턴은 `메모리 측면`과 `데이터 공유 측면`에서 이점을 갖고 있지만 다음과 같이 많은 문제점들을 수반하기 때문에 **trade-off**를 잘 고려해야 한다.  

trade-off (상충관계)
: "하나를 얻으면 다른 하나를 잃는다."
: 예: 프로그램의 성능을 높일 수록 메모리의 사용량 증가

<br>

먼저, **구현 코드 자체가 많다**.  
정적 팩토리 메서드에서 객체 생성을 확인하고 생성자를 호출하는 경우에는 `멀티스레딩` 환경에서 발생할 수 있는 **동시성 문제** 해결을 위해 `syncronized` 키워드를 사용해야 한다.  
<br>

다음으로는 **테스트의 어려움**이다.  
싱글톤 인스턴스는 자원을 공유하고 있기 때문에 테스트가 격리된 환경에서 수행되려면 매번 인스턴스의 상태를 초기화해주어 한다.  
안그러면 전역에서 상태를 공유하기 때문에 테스트가 정상적으로 수행되지 않는다.  
<br>

다음으로는 **의존관계상 클라이언트가 구체 클래스에 의존한다**는 점이다.  
이는 `DIP` 원칙을 위반함과 동시에, `OCP` 원칙 위반 가능성이 높아진다.   
<br>

마지막으로는 **내부 속성을 변경하거나 초기화하기 어렵다**는 점과, **private 생성자로 자식 클래스를 만들기 어렵다**는 점이다.  
<br>

**결론적으로 유연성이 떨어진다고 할 수 있어, `안티패턴`으로 불리기도 한다.**  
<br>

**하지만**  
`스프링 프레임워크(Spring Framework)`는 앞서 나온 싱글톤 패턴의 문제점들을 해결하면서, 객체 인스턴스를 싱글톤으로 관리해준다.  
`스프링 빈(spring bean)`이 바로 싱글톤으로 관리되는 빈이다.

## 싱글톤 컨테이너
스프링 컨테이너는 싱글톤 패턴을 적용하지 않아도 객체 인스턴스를 싱글톤으로 관리한다.  
스프링 컨테이너는 **싱글톤 컨테이너**의 역할을 한다고 할 수 있다.  
이렇게 싱글톤 객체를 생성하고 관리하는 기능을 **싱글톤 레지스트리**라고 한다.  
<br>

스프링 컨테이너의 이런 기능 덕분에 싱글톤 패턴의 모든 단점을 해결하면서 객체를 싱글톤으로 유지할 수 있다.  
싱글톤 컨테이너를 적용한 후에는 객체 호출이 될 때 마다 객체를 생성하는 것이 아닌, 이미 만들어진 객체를 **공유**해서 효율적으로 재사용할 수 있다.  

>참고: 스프링의 기본 빈 등록 방식은 싱글톤이지만, 싱글톤 방식만 지원하는 것은 아니다.  요청할 때마다 새로운 객체를 생성해서 반환하는 기능도 제공한다.  

# 참고자료
[내 깃허브 (private)spring-core-basic](https://github.com/hellojunho/SpringBoot-core-basic/blob/main/core/day4.md)  
[https://tecoble.techcourse.co.kr/post/2020-11-07-singleton/](https://tecoble.techcourse.co.kr/post/2020-11-07-singleton/)  
스프링 핵심 원리 (기본편) - [인프런] 김영한 강사님  